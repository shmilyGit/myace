{% extends "frame/base.html" %}
{% load staticfiles %}
{% block content %}
<div class="row">
	<div class="col-xs-12">
		<div>
			<table id="otrequest-list-table" class="table table-striped table-bordered table-hover">
				<thead>
					<tr>
						<th class="center">
							<label class="pos-rel">
								<input type="checkbox" class="ace" />
								<span class="lbl"></span>
							</label>
						</th>
						<th class="center">序号</th>
						<th class="center">加班日期</th>
						<th class="center">加班原因</th>
						<th class="center">审批状态</th>
						<th class="center">提交时间</th>
						<th class="center">操作</th>
					</tr>
				</thead>
				<tbody>
                    {% for otrequest in otrequests %}
                    <tr {% if forloop.counter|divisibleby:4 %} class="even" {% else %} class="odd" {% endif %}>
						<td class="center">
							<label class="pos-rel">
								<input type="checkbox" class="ace" />
								<span class="lbl"></span>
							</label>
						</td>
                        <td class="center">{{ forloop.counter }}</td>
                        <td class="center">{{ otrequest.ottime }}</td>
                        <td class="center">{{ otrequest.reason }}</td>
                        <td class="center">{% if otrequest.approve %}审批{% else %}未审批{% endif %}</td>
                        <td class="center">{{ otrequest.created | date:"Y-m-d H:m:s" }}</td>
						<td class="center">
							<div class="hidden-sm hidden-xs action-buttons">
								<a class="green" href="{% url 'otrest:edit_otrequest' otrequest.id %}">
									<i class="ace-icon fa fa-pencil bigger-130"></i>
								</a>

								<a class="red del-otrequest" href="{% url 'otrest:del_otrequest' otrequest.id %}">
									<i class="ace-icon fa fa-trash-o bigger-130"></i>
								</a>
							</div>

							<div class="hidden-md hidden-lg">
								<div class="inline pos-rel">
									<button class="btn btn-minier btn-gray dropdown-toggle" data-toggle="dropdown" data-position="auto">
										<i class="ace-icon fa fa-caret-down icon-only bigger-120"></i>
									</button>

									<ul class="dropdown-menu dropdown-only-icon dropdown-yellow dropdown-menu-right dropdown-caret dropdown-close">
										<li>
											<a href="{% url 'otrest:edit_otrequest' otrequest.id %}" class="tooltip-success" data-rel="tooltip" title="Edit">
												<span class="green">
													<i class="ace-icon fa fa-pencil-square-o bigger-120"></i>
												</span>
											</a>
										</li>

										<li>
											<a href="{% url 'otrest:del_otrequest' otrequest.id %}" class="tooltip-error del-otrequest" data-rel="tooltip" title="Delete">
												<span class="red">
													<i class="ace-icon fa fa-trash-o bigger-120"></i>
												</span>
											</a>
										</li>
									</ul>
								</div>
							</div>
						</td>
                    </tr>
                    {% endfor %}
				</tbody>
			</table>
		</div>
	</div>
</div>
{% endblock %}

{% block jsscript%}
<script type="text/javascript" src="{% static 'assets/js/jquery.dataTables.min.js' %}"></script>
<script type="text/javascript" src="{% static 'assets/js/jquery.dataTables.bootstrap.min.js' %}"></script>
<script type="text/javascript" src="{% static 'assets/js/dataTables.buttons.min.js' %}"></script>
<script type="text/javascript" src="{% static 'assets/js/dataTables.select.min.js' %}"></script>
<script type="text/javascript" src="{% static 'common/js/csrf.js' %}"></script>
<script type="text/javascript">
	jQuery(function($) {
		//initiate dataTables plugin
		var myTable = 
		$('#otrequest-list-table')
		//.wrap("<div class='dataTables_borderWrap' />")   //if you are applying horizontal scrolling (sScrollX)
		.DataTable( {
			bAutoWidth: false,
			"aoColumns": [
			  { "bSortable": false },
			  null, null,null, null, null,
			  { "bSortable": false }
			],
			"aaSorting": [],
			
			
			//"bProcessing": true,
	        //"bServerSide": true,
	        //"sAjaxSource": "http://127.0.0.1/table.php"	,
	
			//,
			//"sScrollY": "200px",
			//"bPaginate": false,
	
			//"sScrollX": "100%",
			//"sScrollXInner": "120%",
			//"bScrollCollapse": true,
			//Note: if you are applying horizontal scrolling (sScrollX) on a ".table-bordered"
			//you may want to wrap the table inside a "div.dataTables_borderWrap" element
	
			//"iDisplayLength": 50
	
	
			select: {
				style: 'multi'
			}
	    } );
		////
	
		myTable.on( 'select', function ( e, dt, type, index ) {
			if ( type === 'row' ) {
				$( myTable.row( index ).node() ).find('input:checkbox').prop('checked', true);
			}
		} );
		myTable.on( 'deselect', function ( e, dt, type, index ) {
			if ( type === 'row' ) {
				$( myTable.row( index ).node() ).find('input:checkbox').prop('checked', false);
			}
		} );
	
		/////////////////////////////////
		//table checkboxes
		$('th input[type=checkbox], td input[type=checkbox]').prop('checked', false);
		
		//select/deselect all rows according to table header checkbox
		$('#otrequest-list-table > thead > tr > th input[type=checkbox], #otrequest-list-table_wrapper input[type=checkbox]').eq(0).on('click', function(){
			var th_checked = this.checked;//checkbox inside "TH" table header
			
			$('#otrequest-list-table').find('tbody > tr').each(function(){
				var row = this;
				if(th_checked) myTable.row(row).select();
				else  myTable.row(row).deselect();
			});
		});
		
		//select/deselect a row when the checkbox is checked/unchecked
		$('#otrequest-list-table').on('click', 'td input[type=checkbox]' , function(){
			var row = $(this).closest('tr').get(0);
			if(this.checked) myTable.row(row).deselect();
			else myTable.row(row).select();
		});
	
	
		$(document).on('click', '#otrequest-list-table .dropdown-toggle', function(e) {
			e.stopImmediatePropagation();
			e.stopPropagation();
			e.preventDefault();
		});

        var onDelete = function(){
            var r = confirm("确定要删除?");
            if (!r){
                return false;
            }

            $.post(this.href, function(data){
                if (data.result == "ok"){
                    //window.location.href = "{% url 'otrest:list_otrequest' %}"
                    window.location.reload();
                }else {
                    alert ("删除失败.");
                }
            }).fail(function(){
                alert("删除出错.");
            });

            return false;
        }
        
        $(".del-otrequest").click(onDelete);

	});
</script>
{% endblock %}
